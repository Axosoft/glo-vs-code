#!groovy

def target = "Glo VS Code"
def configuration = "dev"
def slackChannel = "#axo-dev-stream"

node('centos') {
  slackSend message: "${target}  -  `${configuration}` build starting", channel: slackChannel

  try {
    stage("Pull repo") {
      // start clean
      deleteDir()

      // pull files from git
      checkout scm
    }

    // load script
    def build = load "./build/shared/build.groovy"

    stage("Build app bundle") {
      build.build_app_bundle(configuration)
    }

    def fileName
    stage("Build ${target}") {
      fileName = build.build_vs_code(configuration)
    }

    slackSend color: '#00FF00', message: "${target}  -  `${configuration}` build completed  -  plugin ready: https://jenkins2.axosoft.com/job/GitKraken/job/glo-atom/job/dev/lastSuccessfulBuild/artifact/${fileName}", channel: slackChannel
  }
  catch (err) {
    slackSend color: '#FF0000', message: "${target}  -  `${configuration}` build failed", channel: slackChannel
    throw err
  }
}